<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Upload Documents — RedHat Funding</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@500;700&family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" crossorigin href="/assets/index-J0gsu3CU.css" />
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
  <style>
    :root {
      --brand: #cc0000;
      --red: #cc0000;
      --ink: #0b1320;
      --muted: #5b6471;
      --line: #e6eaf0;
      --radius-lg: 24px;
      --bg: #f6f8fb;
      --shadow-soft: 0 12px 36px rgba(11, 19, 32, 0.08);
    }

    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--ink);
      -webkit-font-smoothing: antialiased;
    }

    .topbar {
      position: sticky;
      top: 0;
      z-index: 50;
      width: 100%;
      background: #fff;
      border-bottom: 1px solid var(--line);
    }

    .topbar__inner {
      max-width: 1152px;
      /* 72rem (max-w-6xl) */
      margin: 0 auto;
      height: 64px;
      /* h-16 */
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      /* px-4 */
      gap: 20px;
    }

    .brand {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }

    .brand__hat {
      height: 64px;
      width: auto;
      display: inline-block;
    }

    .brand__text {
      display: inline-flex;
      align-items: baseline;
      gap: 4px;
      font-weight: 600;
      font-size: 20px;
    }

    .brand__text .red {
      color: var(--brand);
    }

    .brand__text .dark {
      color: var(--ink);
    }

    .nav {
      display: inline-flex;
      align-items: center;
      gap: 24px;
      /* gap-6 */
      font-size: 14px;
      font-weight: 500;
    }

    .nav a {
      text-decoration: none;
      color: var(--muted);
      transition: color 120ms ease;
    }

    .nav a:hover {
      color: var(--ink);
    }

    .topbar__cta {
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

    .btn-apply {
      padding: 10px 20px;
      border-radius: 999px;
      border: none;
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      background: var(--brand);
      color: #fff;
      box-shadow: var(--shadow-soft);
      transition: transform 120ms ease, box-shadow 120ms ease;
    }

    .btn-apply:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 30px rgba(11, 19, 32, 0.12);
    }

    /* Hide Upload Documents in top nav; we use the floating button instead */
    .nav a[href*="upload-documents"] {
      display: none !important;
    }

    /* Hide Upload Documents in top nav; we use the floating button instead */
    .nav a[href*="upload-documents"] {
      display: none !important;
    }

    .page {
      max-width: 1152px;
      margin: 0 auto;
      padding: 32px 20px 64px;
    }

    .hero {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 24px;
      padding: 20px 24px;
      border: 1px solid var(--line);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      background: #fff;
    }

    .hero h1 {
      margin: 0 0 8px;
      font-size: 30px;
      font-weight: 800;
      color: var(--ink);
    }

    .hero p {
      margin: 0;
      font-size: 17px;
      color: #4b5262;
    }

    .hero-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 12px 18px;
      border-radius: 999px;
      border: 1px solid transparent;
      font-weight: 700;
      font-size: 16px;
      text-decoration: none;
      cursor: pointer;
      transition: transform 120ms ease, box-shadow 120ms ease, border-color 120ms ease;
    }

    .btn-primary {
      background: var(--red);
      color: #fff;
      box-shadow: 0 12px 26px rgba(193, 17, 31, 0.28);
    }

    .btn-outline {
      background: #fff;
      color: var(--ink);
      border-color: #e0e4ea;
    }

    .btn:hover {
      transform: translateY(-1px);
    }

    .section {
      margin-top: 32px;
      border: 1px solid #f0d9d3;
      border-radius: 16px;
      padding: 20px 24px;
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.05);
    }

    .section h2 {
      margin: 0 0 12px;
      font-size: 22px;
    }

    .pdf-viewer {
      width: 100%;
      height: 520px;
      border: 1px solid #e2e6ed;
      border-radius: 12px;
      overflow: hidden;
      background: #fafafa;
    }

    .upload-box {
      border: 2px dashed rgba(204, 0, 0, 0.6);
      border-radius: 14px;
      padding: 22px;
      text-align: center;
      background: rgba(204, 0, 0, 0.22);
      color: #4b5262;
    }

    .upload-box strong {
      display: block;
      margin-bottom: 8px;
      font-size: 18px;
      color: var(--ink);
    }

    .file-input {
      margin: 12px 0;
    }

    .note {
      font-size: 14px;
      color: #5b6272;
    }

    .file-list {
      margin-top: 10px;
      font-size: 14px;
      color: #2c3344;
    }

    input[type="text"],
    input[type="email"] {
      background: rgba(204, 0, 0, 0.22);
      border: 1px solid rgba(204, 0, 0, 0.6);
      border-radius: 8px;
      padding: 10px 12px;
    }

    .missing {
      border-color: #c1111f;
      box-shadow: 0 0 0 1px rgba(193, 17, 31, 0.2);
    }

    @media (max-width: 800px) {
      .hero {
        flex-direction: column;
        align-items: flex-start;
      }

      .hero-actions {
        width: 100%;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }

      .pdf-viewer {
        height: 420px;
      }
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="topbar__inner">
      <a class="brand" href="/">
        <img src="/chatgpt-image-oct-15-2025.png" alt="RedHat Funding Logo" class="brand__hat" />
        <span class="brand__text">
          <span class="red">RedHat</span>
          <span class="dark">Funding</span>
        </span>
      </a>
      <nav class="nav">
        <a href="/#how-it-works">How it works</a>
        <a href="/#benefits">Benefits</a>
        <a href="/#faqs">FAQs</a>
        <a href="/apply">Apply</a>
      </nav>
      <div class="topbar__cta">
        <a class="btn-apply" href="/apply">Apply Now</a>
      </div>
    </div>
  </header>
  <div class="page">
    <div class="hero">
      <div>
        <h1>Upload Documents</h1>
        <p>Fill and sign the application below, then include your bank statements.</p>
      </div>
    </div>

    <div id="upload" class="section">
      <h2>Fill, sign, and upload</h2>
      <p class="note">
        Fill the fields below, add your signature (typed and/or drawn), and attach your bank statements. We’ll generate
        the filled, signed PDF and send it with your statements to our funding professionals for review and submission.
        You can preview the filled official RedHat Funding PDF before submitting.
      </p>
      <form id="drive-upload-form" method="POST" enctype="multipart/form-data"
        action="https://script.google.com/macros/s/AKfycbzrf9b7poCbvPR3TzeZEzi12ewwZ9Wp7ZyCjf-tLDwjKddjvomihzTwN7vcYqE0KaYJqw/exec">
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;">
          <label>Business Legal Name*
            <input type="text" name="business_name" required />
          </label>
          <label>Business DBA Name
            <input type="text" name="business_dba_name" />
          </label>
          <label>Type of Business Entity
            <input type="text" name="business_entity_type" />
          </label>
          <label>Business Phone #
            <input type="text" name="business_phone" />
          </label>
          <label>Federal Tax ID
            <input type="text" name="federal_tax_id" />
          </label>
          <label>Business Start Date
            <input type="text" name="business_start_date" placeholder="MM-DD-YYYY" />
          </label>
          <label>Street Address
            <input type="text" name="business_street" />
          </label>
          <label>City
            <input type="text" name="business_city" />
          </label>
          <label>State
            <input type="text" name="business_state" />
          </label>
          <label>Zip Code
            <input type="text" name="business_zip" />
          </label>
          <label>Owner First Name
            <input type="text" name="owner_first_name" />
          </label>
          <label>Owner Last Name
            <input type="text" name="owner_last_name" />
          </label>
          <label>Ownership %
            <input type="text" name="ownership_percent" />
          </label>
          <label>Home Address
            <input type="text" name="owner_home_address" />
          </label>
          <label>Owner City
            <input type="text" name="owner_city" />
          </label>
          <label>Owner State
            <input type="text" name="owner_state" />
          </label>
          <label>Owner Zip
            <input type="text" name="owner_zip" />
          </label>
          <label>Date of Birth
            <input type="text" name="owner_dob" placeholder="MM-DD-YYYY" />
          </label>
          <label>SSN
            <input type="text" name="owner_ssn" />
          </label>
          <label>Email
            <input type="email" name="owner_email" />
          </label>
          <label>Cellphone #
            <input type="text" name="owner_cellphone" />
          </label>
          <label>FICO Score
            <input type="text" name="owner_fico" />
          </label>
          <label>Signature (type your name)*
            <input type="text" name="signature_name" required />
          </label>
          <label>Signature Date
            <input type="text" name="signature_date" placeholder="MM-DD-YYYY" />
          </label>
        </div>

        <div style="margin-top:14px;">
          <div style="display:flex; gap:12px; align-items:center; margin-bottom:6px;">
            <div style="font-weight:600;">Draw Signature (optional)</div>
            <button type="button" id="sig-clear" class="btn btn-outline" style="padding:6px 12px;">Clear</button>
          </div>
          <canvas id="sig-canvas" width="380" height="120"
            style="border:1px solid #d8dde6; border-radius:8px; background:#fff;"></canvas>
        </div>

        <div class="upload-box" id="dropzone" style="margin-top:16px;">
          <strong>Bank statements or other attachments</strong>
          <div>Drag & drop files here</div>
          <div>or</div>
          <input class="file-input" type="file" name="files[]" id="fileInput" multiple accept=".pdf,.jpg,.jpeg,.png" />
          <div class="note">We will generate the signed application PDF; attach bank statements here.</div>
          <div class="file-list" id="fileList"></div>
        </div>

        <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
          <button type="button" class="btn btn-outline" id="preview-btn" style="padding:10px 14px;">Preview filled
            PDF</button>
          <button type="submit" class="btn btn-primary">Generate & Submit</button>
          <span class="note" id="upload-status"></span>
        </div>
      </form>
    </div>
  </div>

  <script>
    (function () {
      const form = document.getElementById("drive-upload-form");
      const fileInput = document.getElementById("fileInput");
      const fileList = document.getElementById("fileList");
      const dropzone = document.getElementById("dropzone");

      function renderFiles(files) {
        if (!files || !files.length) {
          fileList.textContent = "";
          return;
        }
        const names = Array.from(files).map((f) => f.name + " (" + Math.round(f.size / 1024) + " KB)");
        fileList.textContent = names.join(" • ");
      }

      dropzone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropzone.style.borderColor = "var(--red)";
      });
      dropzone.addEventListener("dragleave", () => {
        dropzone.style.borderColor = "#d8dde6";
      });
      dropzone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropzone.style.borderColor = "#d8dde6";
        if (e.dataTransfer.files.length) {
          fileInput.files = e.dataTransfer.files;
          renderFiles(e.dataTransfer.files);
        }
      });

      fileInput.addEventListener("change", () => renderFiles(fileInput.files));

      // ===== SIGNATURE PAD FUNCTIONALITY =====
      const sigCanvas = document.getElementById("sig-canvas");
      const sigCtx = sigCanvas.getContext("2d");
      let isDrawing = false;
      let lastX = 0;
      let lastY = 0;

      // Set up drawing style
      sigCtx.strokeStyle = "#000";
      sigCtx.lineWidth = 2;
      sigCtx.lineCap = "round";
      sigCtx.lineJoin = "round";

      function getPos(e) {
        const rect = sigCanvas.getBoundingClientRect();
        const scaleX = sigCanvas.width / rect.width;
        const scaleY = sigCanvas.height / rect.height;

        if (e.touches && e.touches.length > 0) {
          return {
            x: (e.touches[0].clientX - rect.left) * scaleX,
            y: (e.touches[0].clientY - rect.top) * scaleY
          };
        }
        return {
          x: (e.clientX - rect.left) * scaleX,
          y: (e.clientY - rect.top) * scaleY
        };
      }

      function startDrawing(e) {
        e.preventDefault();
        isDrawing = true;
        const pos = getPos(e);
        lastX = pos.x;
        lastY = pos.y;
      }

      function draw(e) {
        if (!isDrawing) return;
        e.preventDefault();
        const pos = getPos(e);
        sigCtx.beginPath();
        sigCtx.moveTo(lastX, lastY);
        sigCtx.lineTo(pos.x, pos.y);
        sigCtx.stroke();
        lastX = pos.x;
        lastY = pos.y;
      }

      function stopDrawing() {
        isDrawing = false;
      }

      // Mouse events
      sigCanvas.addEventListener("mousedown", startDrawing);
      sigCanvas.addEventListener("mousemove", draw);
      sigCanvas.addEventListener("mouseup", stopDrawing);
      sigCanvas.addEventListener("mouseout", stopDrawing);

      // Touch events (for mobile/tablet)
      sigCanvas.addEventListener("touchstart", startDrawing, { passive: false });
      sigCanvas.addEventListener("touchmove", draw, { passive: false });
      sigCanvas.addEventListener("touchend", stopDrawing);
      sigCanvas.addEventListener("touchcancel", stopDrawing);

      // Clear button
      document.getElementById("sig-clear").addEventListener("click", () => {
        sigCtx.clearRect(0, 0, sigCanvas.width, sigCanvas.height);
      });
      // ===== END SIGNATURE PAD =====

      async function buildPdfBlob() {
        const pdfBytes = await fetch("./RedHat_Funding_Simple_Application_fullpage.pdf").then((r) => r.arrayBuffer());
        const pdfDoc = await PDFLib.PDFDocument.load(pdfBytes);
        const formPdf = pdfDoc.getForm();
        const fields = {
          business_legal_name: form.business_name.value,
          business_dba_name: form.business_dba_name.value,
          business_entity_type: form.business_entity_type.value,
          business_street: form.business_street.value,
          business_city: form.business_city.value,
          business_state: form.business_state.value,
          business_zip: form.business_zip.value,
          business_phone: form.business_phone.value,
          federal_tax_id: form.federal_tax_id.value,
          business_start_date: form.business_start_date.value,
          owner_first_name: form.owner_first_name.value,
          owner_last_name: form.owner_last_name.value,
          ownership_percent: form.ownership_percent.value,
          owner_home_address: form.owner_home_address.value,
          owner_city: form.owner_city.value,
          owner_state: form.owner_state.value,
          owner_zip: form.owner_zip.value,
          owner_dob: form.owner_dob.value,
          owner_ssn: form.owner_ssn.value,
          owner_email: form.owner_email.value,
          owner_cellphone: form.owner_cellphone.value,
          owner_fico: form.owner_fico.value,
          printed_name: form.signature_name.value,
          owner_officer_signature: form.signature_name.value,
          signature_date: form.signature_date.value || new Date().toLocaleDateString(),
        };
        Object.entries(fields).forEach(([name, val]) => {
          const f = formPdf.getFieldMaybe ? formPdf.getFieldMaybe(name) : formPdf.getTextField(name);
          if (f && typeof f.setText === "function") f.setText(val || "");
        });
        const canvas = document.getElementById("sig-canvas");
        const hasInk = (() => {
          const ctx = canvas.getContext("2d");
          const pixels = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
          for (let i = 3; i < pixels.length; i += 4) {
            if (pixels[i] !== 0) return true;
          }
          return false;
        })();
        if (hasInk) {
          const dataUrl = canvas.toDataURL("image/png");
          const pngImage = await pdfDoc.embedPng(dataUrl);
          const page = pdfDoc.getPage(0);
          page.drawImage(pngImage, {
            x: 325,
            y: 20,
            width: 180,
            height: 35,
          });
        }
        const signedBytes = await pdfDoc.save();
        return new Blob([signedBytes], { type: "application/pdf" });
      }

      document.getElementById("preview-btn").addEventListener("click", async () => {
        try {
          const blob = await buildPdfBlob();
          const url = URL.createObjectURL(blob);
          window.open(url, "_blank");
        } catch (err) {
          alert("Could not build preview: " + err);
        }
      });

      // Prefill from query string
      (function prefillFromQuery() {
        const params = new URLSearchParams(window.location.search);
        if (!params.size) return;
        const fields = [
          "business_name",
          "business_dba_name",
          "business_entity_type",
          "business_phone",
          "federal_tax_id",
          "business_start_date",
          "business_street",
          "business_city",
          "business_state",
          "business_zip",
          "owner_first_name",
          "owner_last_name",
          "ownership_percent",
          "owner_home_address",
          "owner_city",
          "owner_state",
          "owner_zip",
          "owner_dob",
          "owner_ssn",
          "owner_email",
          "owner_cellphone",
          "owner_fico",
          "signature_name",
          "signature_date",
        ];
        fields.forEach((name) => {
          const el = form.elements[name];
          if (el && params.has(name)) {
            el.value = params.get(name);
          }
        });
        fields.forEach((name) => {
          const el = form.elements[name];
          if (el && !el.value.trim()) {
            el.classList.add("missing");
          } else if (el) {
            el.classList.remove("missing");
          }
        });
      })();

      form.addEventListener("input", (e) => {
        if (e.target.classList.contains("missing") && e.target.value.trim()) {
          e.target.classList.remove("missing");
        }
      });

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const status = document.getElementById("upload-status");
        const submitBtn = form.querySelector('button[type="submit"]');
        status.textContent = "";

        if (!form.business_name.value.trim()) {
          alert("Please enter your business legal name.");
          return;
        }

        // Disable submit button during upload
        submitBtn.disabled = true;
        submitBtn.textContent = "Submitting...";

        // Helper function to convert blob/file to base64
        function fileToBase64(file) {
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => {
              const base64 = reader.result.split(',')[1]; // Remove data:...;base64, prefix
              resolve({
                name: file.name,
                mimeType: file.type || 'application/octet-stream',
                data: base64
              });
            };
            reader.onerror = reject;
            reader.readAsDataURL(file);
          });
        }

        try {
          status.textContent = "Building signed PDF...";
          const signedBlob = await buildPdfBlob();

          status.textContent = "Preparing files for upload...";

          // Convert all files to base64
          const files = [];

          // Add the generated signed PDF
          const signedPdfFile = new File([signedBlob], "Application-Signed.pdf", { type: "application/pdf" });
          files.push(await fileToBase64(signedPdfFile));

          // Add any attached bank statements
          for (const f of Array.from(fileInput.files || [])) {
            files.push(await fileToBase64(f));
          }

          // Build the payload as JSON
          const payload = {
            business_name: form.business_name.value,
            files: files
          };

          status.textContent = "Uploading to our secure servers...";

          const res = await fetch(form.action, {
            method: "POST",
            mode: "no-cors", // Required for cross-origin Apps Script
            headers: {
              "Content-Type": "text/plain" // Apps Script works better with text/plain
            },
            body: JSON.stringify(payload)
          });

          // With no-cors mode, we can't read the response, so redirect on success
          window.location.href = "/thank-you.html";

        } catch (err) {
          console.error(err);
          status.textContent = "Error: " + err.message;
          submitBtn.disabled = false;
          submitBtn.textContent = "Generate & Submit";
        }
      });
    })();
  </script>
  <a href="/upload-documents.html" class="floating-upload-link" aria-label="Upload Documents">
    Upload Documents
  </a>
  <style>
    .floating-upload-link {
      position: fixed;
      bottom: 18px;
      right: 18px;
      z-index: 9999;
      padding: 12px 16px;
      border-radius: 999px;
      background: #c1111f;
      color: #fff;
      text-decoration: none;
      font-weight: 700;
      font-family: "Inter", system-ui, -apple-system, sans-serif;
      box-shadow: 0 10px 26px rgba(193, 17, 31, 0.28);
      transition: transform 120ms ease, box-shadow 120ms ease;
    }

    .floating-upload-link:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 32px rgba(193, 17, 31, 0.32);
    }

    .floating-upload-link:active {
      transform: translateY(0);
    }
  </style>
</body>
<script>
  // Ensure any lingering #apply links point to the real apply route.
  document.querySelectorAll('a[href$="#apply"]').forEach((a) => {
    a.href = "/apply";
  });
</script>

</html>